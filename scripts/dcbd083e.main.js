"use strict";(function(a,b){var c=function(a,b){return function(){a.apply(b,arguments)}},d=function(a){this.canvas=a,this.context=this.canvas.getContext("2d"),this.drawableObjects=[],this.width=b(a).width(),this.height=b(a).height()};d.prototype=Object.create({}),d.fn=d.prototype,d.fn.push=function(a){return this.drawableObjects.push(a),this},d.fn.render=function(){return _(this.drawableObjects).chain().sortBy("order").each(function(a){a.draw(this.context)},this).value(),this},d.fn.clear=function(){this.context.fillStyle="white",this.context.fillRect(0,0,this.width,this.height)};var e=function(a,d){this.subObjects=[],this.order=d.order||0;var e=b.Deferred();this.imgLoaded=e.promise(),d=d||{},this.setPosition(d.xPos||0,d.yPos||0),this.image=new Image,this.image.src=a,this.image.onload=c(function(){this.setScale(d.scale||1),e.resolve()},this),setInterval(_.bind(this.removeStaleObjects,this),100)};e.prototype=Object.create({}),e.fn=e.prototype,e.fn.setPosition=function(a,b){return this.xPos=a,this.yPos=b,this},e.fn.getPosition=function(){return{xPos:this.xPos,yPos:this.yPos}},e.fn.setScale=function(a){return this.width=Math.floor(this.image.width*a),this.height=Math.floor(this.image.height*a),this},e.fn.addSubObject=function(a){this.subObjects.push(a)},e.fn.removeSubObject=function(a){this.subObjects=_(this.subObjects).filter(function(b){return a!==b},this)},e.fn.drawSubObjects=function(a){return _(this.subObjects).chain().sort("order").each(function(b){b.draw(a)}).value(),this},e.fn.removeStaleObjects=function(){return this.subObjects=_(this.subObjects).filter(function(a){return _.isFunction(a.isStale)?!a.isStale():!0},this),this},e.fn.draw=function(a){return this.imgLoaded.done(c(function(){a.drawImage(this.image,this.xPos,this.yPos,this.width,this.height),this.drawSubObjects(a)},this)),this};var f=function(a){e.call(this,"/images/missile.png",a),this.lifespan=a.lifespan||2e3,this.createdAt=Date.now(),setInterval(_.bind(this.moveUp,this),10)};f.prototype=Object.create(e.prototype),f.fn=f.prototype,f.fn.isStale=function(){return Date.now()-this.lifespan>this.createdAt},f.fn.moveUp=function(){var a=this.getPosition();this.setPosition(a.xPos,a.yPos-10)};var g=function(a){e.call(this,"/images/fighter.png",a),this.bindKeyHandler("keydown",{38:this.moveUp,37:this.moveLeft,39:this.moveRight,40:this.moveDown,32:this.fireMissile})};g.prototype=Object.create(e.prototype),g.fn=g.prototype,g.fn.bindKeyHandler=function(c,d){b(a).on("keydown",_.bind(function(a){d[event.keyCode]&&(a.preventDefault(),d[event.keyCode].call(this))},this))},g.fn.fireMissile=function(){return this.addSubObject(new f({xPos:this.xPos+10,yPos:this.yPos-30,scale:1})),this},g.fn.moveLeft=function(){var a=this.getPosition();this.setPosition(a.xPos-10,a.yPos)},g.fn.moveRight=function(){var a=this.getPosition();this.setPosition(a.xPos+10,a.yPos)},g.fn.moveUp=function(){var a=this.getPosition();this.setPosition(a.xPos,a.yPos-10)},g.fn.moveDown=function(){var a=this.getPosition();this.setPosition(a.xPos,a.yPos+10)};var h=function(b){a.requestAnimationFrame(_.bind(h,this,b)),b.clear(),b.render()},i=function(){var a=b("canvas#drawable"),c=new d(a[0]);c.push(new e("/images/background.jpeg",{xPos:0,yPos:0,scale:1})),c.push(new g({xPos:500,yPos:500,scale:.5})),h(c)};b(a).on("ready",i)}).call(this,window,jQuery);